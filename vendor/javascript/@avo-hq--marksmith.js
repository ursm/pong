// @avo-hq/marksmith@0.4.0 downloaded from https://ga.jspm.io/npm:@avo-hq/marksmith@0.4.0/dist/marksmith.esm.js

var t=(void 0,function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e==="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)});var e,n;const r=["[data-md-button]","md-header","md-bold","md-italic","md-quote","md-code","md-link","md-image","md-unordered-list","md-ordered-list","md-task-list","md-mention","md-ref","md-strikethrough"];function getButtons(t){const e=[];for(const n of t.querySelectorAll(r.join(", ")))n.hidden||n.offsetWidth<=0&&n.offsetHeight<=0||n.closest("markdown-toolbar")===t&&e.push(n);return e}function keydown(t){return function(e){e.key!==" "&&e.key!=="Enter"||t(e)}}const i=new WeakMap;const s={"header-1":{prefix:"# "},"header-2":{prefix:"## "},"header-3":{prefix:"### "},"header-4":{prefix:"#### "},"header-5":{prefix:"##### "},"header-6":{prefix:"###### "},bold:{prefix:"**",suffix:"**",trimFirst:true},italic:{prefix:"_",suffix:"_",trimFirst:true},quote:{prefix:"> ",multiline:true,surroundWithNewlines:true},code:{prefix:"`",suffix:"`",blockPrefix:"```",blockSuffix:"```"},link:{prefix:"[",suffix:"](url)",replaceNext:"url",scanFor:"https?://"},image:{prefix:"![",suffix:"](url)",replaceNext:"url",scanFor:"https?://"},"unordered-list":{prefix:"- ",multiline:true,unorderedList:true},"ordered-list":{prefix:"1. ",multiline:true,orderedList:true},"task-list":{prefix:"- [ ] ",multiline:true,surroundWithNewlines:true},mention:{prefix:"@",prefixSpace:true},ref:{prefix:"#",prefixSpace:true},strikethrough:{prefix:"~~",suffix:"~~",trimFirst:true}};class MarkdownButtonElement extends HTMLElement{constructor(){super();const apply=t=>{const e=i.get(this);if(e){t.preventDefault();applyStyle(this,e)}};this.addEventListener("keydown",keydown(apply));this.addEventListener("click",apply)}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","button")}click(){const t=i.get(this);t&&applyStyle(this,t)}}class MarkdownHeaderButtonElement extends MarkdownButtonElement{constructor(){super(...arguments);e.add(this)}connectedCallback(){const r=parseInt(this.getAttribute("level")||"3",10);t(this,e,"m",n).call(this,r)}static get observedAttributes(){return["level"]}attributeChangedCallback(r,i,s){if(r!=="level")return;const o=parseInt(s||"3",10);t(this,e,"m",n).call(this,o)}}e=new WeakSet,n=function _MarkdownHeaderButtonElement_setLevelStyle(t){if(t<1||t>6)return;const e=`${"#".repeat(t)} `;i.set(this,{prefix:e})};if(!window.customElements.get("md-header")){window.MarkdownHeaderButtonElement=MarkdownHeaderButtonElement;window.customElements.define("md-header",MarkdownHeaderButtonElement)}class MarkdownBoldButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"**",suffix:"**",trimFirst:true})}}if(!window.customElements.get("md-bold")){window.MarkdownBoldButtonElement=MarkdownBoldButtonElement;window.customElements.define("md-bold",MarkdownBoldButtonElement)}class MarkdownItalicButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"_",suffix:"_",trimFirst:true})}}if(!window.customElements.get("md-italic")){window.MarkdownItalicButtonElement=MarkdownItalicButtonElement;window.customElements.define("md-italic",MarkdownItalicButtonElement)}class MarkdownQuoteButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"> ",multiline:true,surroundWithNewlines:true})}}if(!window.customElements.get("md-quote")){window.MarkdownQuoteButtonElement=MarkdownQuoteButtonElement;window.customElements.define("md-quote",MarkdownQuoteButtonElement)}class MarkdownCodeButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"`",suffix:"`",blockPrefix:"```",blockSuffix:"```"})}}if(!window.customElements.get("md-code")){window.MarkdownCodeButtonElement=MarkdownCodeButtonElement;window.customElements.define("md-code",MarkdownCodeButtonElement)}class MarkdownLinkButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"[",suffix:"](url)",replaceNext:"url",scanFor:"https?://"})}}if(!window.customElements.get("md-link")){window.MarkdownLinkButtonElement=MarkdownLinkButtonElement;window.customElements.define("md-link",MarkdownLinkButtonElement)}class MarkdownImageButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"![",suffix:"](url)",replaceNext:"url",scanFor:"https?://"})}}if(!window.customElements.get("md-image")){window.MarkdownImageButtonElement=MarkdownImageButtonElement;window.customElements.define("md-image",MarkdownImageButtonElement)}class MarkdownUnorderedListButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"- ",multiline:true,unorderedList:true})}}if(!window.customElements.get("md-unordered-list")){window.MarkdownUnorderedListButtonElement=MarkdownUnorderedListButtonElement;window.customElements.define("md-unordered-list",MarkdownUnorderedListButtonElement)}class MarkdownOrderedListButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"1. ",multiline:true,orderedList:true})}}if(!window.customElements.get("md-ordered-list")){window.MarkdownOrderedListButtonElement=MarkdownOrderedListButtonElement;window.customElements.define("md-ordered-list",MarkdownOrderedListButtonElement)}class MarkdownTaskListButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"- [ ] ",multiline:true,surroundWithNewlines:true})}}if(!window.customElements.get("md-task-list")){window.MarkdownTaskListButtonElement=MarkdownTaskListButtonElement;window.customElements.define("md-task-list",MarkdownTaskListButtonElement)}class MarkdownMentionButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"@",prefixSpace:true})}}if(!window.customElements.get("md-mention")){window.MarkdownMentionButtonElement=MarkdownMentionButtonElement;window.customElements.define("md-mention",MarkdownMentionButtonElement)}class MarkdownRefButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"#",prefixSpace:true})}}if(!window.customElements.get("md-ref")){window.MarkdownRefButtonElement=MarkdownRefButtonElement;window.customElements.define("md-ref",MarkdownRefButtonElement)}class MarkdownStrikethroughButtonElement extends MarkdownButtonElement{connectedCallback(){i.set(this,{prefix:"~~",suffix:"~~",trimFirst:true})}}if(!window.customElements.get("md-strikethrough")){window.MarkdownStrikethroughButtonElement=MarkdownStrikethroughButtonElement;window.customElements.define("md-strikethrough",MarkdownStrikethroughButtonElement)}function applyFromToolbar(t){const{target:e,currentTarget:n}=t;if(!(e instanceof Element))return;const r=e.closest("[data-md-button]");if(!r||r.closest("markdown-toolbar")!==n)return;const i=r.getAttribute("data-md-button");const o=s[i];if(o){t.preventDefault();applyStyle(e,o)}}function setFocusManagement(t){t.addEventListener("keydown",focusKeydown);t.setAttribute("tabindex","0");t.addEventListener("focus",onToolbarFocus,{once:true})}function unsetFocusManagement(t){t.removeEventListener("keydown",focusKeydown);t.removeAttribute("tabindex");t.removeEventListener("focus",onToolbarFocus)}class MarkdownToolbarElement extends HTMLElement{connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","toolbar");this.hasAttribute("data-no-focus")||setFocusManagement(this);this.addEventListener("keydown",keydown(applyFromToolbar));this.addEventListener("click",applyFromToolbar)}attributeChangedCallback(t,e,n){t==="data-no-focus"&&(n===null?setFocusManagement(this):unsetFocusManagement(this))}disconnectedCallback(){unsetFocusManagement(this)}get field(){const t=this.getAttribute("for");if(!t)return null;const e="getRootNode"in this?this.getRootNode():document;let n;(e instanceof Document||e instanceof ShadowRoot)&&(n=e.getElementById(t));return n instanceof HTMLTextAreaElement?n:null}}MarkdownToolbarElement.observedAttributes=["data-no-focus"];function onToolbarFocus({target:t}){if(!(t instanceof Element))return;t.removeAttribute("tabindex");let e="0";for(const n of getButtons(t)){n.setAttribute("tabindex",e);if(e==="0"){n.focus();e="-1"}}}function focusKeydown(t){const e=t.key;if(e!=="ArrowRight"&&e!=="ArrowLeft"&&e!=="Home"&&e!=="End")return;const n=t.currentTarget;if(!(n instanceof HTMLElement))return;const r=getButtons(n);const i=r.indexOf(t.target);const s=r.length;if(i===-1)return;let o=0;e==="ArrowLeft"&&(o=i-1);e==="ArrowRight"&&(o=i+1);e==="End"&&(o=s-1);o<0&&(o=s-1);o>s-1&&(o=0);for(let t=0;t<s;t+=1)r[t].setAttribute("tabindex",t===o?"0":"-1");t.preventDefault();r[o].focus()}if(!window.customElements.get("markdown-toolbar")){window.MarkdownToolbarElement=MarkdownToolbarElement;window.customElements.define("markdown-toolbar",MarkdownToolbarElement)}function isMultipleLines(t){return t.trim().split("\n").length>1}function repeat(t,e){return Array(e+1).join(t)}function wordSelectionStart(t,e){let n=e;while(t[n]&&t[n-1]!=null&&!t[n-1].match(/\s/))n--;return n}function wordSelectionEnd(t,e,n){let r=e;const i=n?/\n/:/\s/;while(t[r]&&!t[r].match(i))r++;return r}let o=null;function insertText$1(t,{text:e,selectionStart:n,selectionEnd:r}){const i=t.selectionStart;const s=t.value.slice(0,i);const l=t.value.slice(t.selectionEnd);if(o===null||o===true){t.contentEditable="true";try{o=document.execCommand("insertText",false,e)}catch(t){o=false}t.contentEditable="false"}o&&!t.value.slice(0,t.selectionStart).endsWith(e)&&(o=false);if(!o){try{document.execCommand("ms-beginUndoUnit")}catch(t){}t.value=s+e+l;try{document.execCommand("ms-endUndoUnit")}catch(t){}t.dispatchEvent(new CustomEvent("input",{bubbles:true,cancelable:true}))}n!=null&&r!=null?t.setSelectionRange(n,r):t.setSelectionRange(i,t.selectionEnd)}function styleSelectedText(t,e){const n=t.value.slice(t.selectionStart,t.selectionEnd);let r;r=e.orderedList||e.unorderedList?listStyle(t,e):e.multiline&&isMultipleLines(n)?multilineStyle(t,e):blockStyle(t,e);insertText$1(t,r)}function expandSelectionToLine(t){const e=t.value.split("\n");let n=0;for(let r=0;r<e.length;r++){const i=e[r].length+1;t.selectionStart>=n&&t.selectionStart<n+i&&(t.selectionStart=n);t.selectionEnd>=n&&t.selectionEnd<n+i&&(t.selectionEnd=n+i-1);n+=i}}function expandSelectedText(t,e,n,r=false){if(t.selectionStart===t.selectionEnd){t.selectionStart=wordSelectionStart(t.value,t.selectionStart);t.selectionEnd=wordSelectionEnd(t.value,t.selectionEnd,r)}else{const r=t.selectionStart-e.length;const i=t.selectionEnd+n.length;const s=t.value.slice(r,t.selectionStart)===e;const o=t.value.slice(t.selectionEnd,i)===n;if(s&&o){t.selectionStart=r;t.selectionEnd=i}}return t.value.slice(t.selectionStart,t.selectionEnd)}function newlinesToSurroundSelectedText(t){const e=t.value.slice(0,t.selectionStart);const n=t.value.slice(t.selectionEnd);const r=e.match(/\n*$/);const i=n.match(/^\n*/);const s=r?r[0].length:0;const o=i?i[0].length:0;let l;let c;e.match(/\S/)&&s<2&&(l=repeat("\n",2-s));n.match(/\S/)&&o<2&&(c=repeat("\n",2-o));l==null&&(l="");c==null&&(c="");return{newlinesToAppend:l,newlinesToPrepend:c}}function blockStyle(t,e){let n;let r;const{prefix:i,suffix:s,blockPrefix:o,blockSuffix:l,replaceNext:c,prefixSpace:u,scanFor:d,surroundWithNewlines:f}=e;const h=t.selectionStart;const p=t.selectionEnd;let m=t.value.slice(t.selectionStart,t.selectionEnd);let g=isMultipleLines(m)&&o.length>0?`${o}\n`:i;let b=isMultipleLines(m)&&l.length>0?`\n${l}`:s;if(u){const e=t.value[t.selectionStart-1];t.selectionStart===0||e==null||e.match(/\s/)||(g=` ${g}`)}m=expandSelectedText(t,g,b,e.multiline);let y=t.selectionStart;let w=t.selectionEnd;const k=c.length>0&&b.indexOf(c)>-1&&m.length>0;if(f){const e=newlinesToSurroundSelectedText(t);n=e.newlinesToAppend;r=e.newlinesToPrepend;g=n+i;b+=r}if(m.startsWith(g)&&m.endsWith(b)){const t=m.slice(g.length,m.length-b.length);if(h===p){let e=h-g.length;e=Math.max(e,y);e=Math.min(e,y+t.length);y=w=e}else w=y+t.length;return{text:t,selectionStart:y,selectionEnd:w}}if(k){if(d.length>0&&m.match(d)){b=b.replace(c,m);const t=g+b;y=w=y+g.length;return{text:t,selectionStart:y,selectionEnd:w}}{const t=g+m+b;y=y+g.length+m.length+b.indexOf(c);w=y+c.length;return{text:t,selectionStart:y,selectionEnd:w}}}{let t=g+m+b;y=h+g.length;w=p+g.length;const n=m.match(/^\s*|\s*$/g);if(e.trimFirst&&n){const e=n[0]||"";const r=n[1]||"";t=e+g+m.trim()+b+r;y+=e.length;w-=r.length}return{text:t,selectionStart:y,selectionEnd:w}}}function multilineStyle(t,e){const{prefix:n,suffix:r,surroundWithNewlines:i}=e;let s=t.value.slice(t.selectionStart,t.selectionEnd);let o=t.selectionStart;let l=t.selectionEnd;const c=s.split("\n");const u=c.every((t=>t.startsWith(n)&&t.endsWith(r)));if(u){s=c.map((t=>t.slice(n.length,t.length-r.length))).join("\n");l=o+s.length}else{s=c.map((t=>n+t+r)).join("\n");if(i){const{newlinesToAppend:e,newlinesToPrepend:n}=newlinesToSurroundSelectedText(t);o+=e.length;l=o+s.length;s=e+s+n}}return{text:s,selectionStart:o,selectionEnd:l}}function undoOrderedListStyle(t){const e=t.split("\n");const n=/^\d+\.\s+/;const r=e.every((t=>n.test(t)));let i=e;r&&(i=e.map((t=>t.replace(n,""))));return{text:i.join("\n"),processed:r}}function undoUnorderedListStyle(t){const e=t.split("\n");const n="- ";const r=e.every((t=>t.startsWith(n)));let i=e;r&&(i=e.map((t=>t.slice(n.length,t.length))));return{text:i.join("\n"),processed:r}}function makePrefix(t,e){return e?"- ":`${t+1}. `}function clearExistingListStyle(t,e){let n;let r;let i;if(t.orderedList){r=undoOrderedListStyle(e);n=undoUnorderedListStyle(r.text);i=n.text}else{r=undoUnorderedListStyle(e);n=undoOrderedListStyle(r.text);i=n.text}return[r,n,i]}function listStyle(t,e){const n=t.selectionStart===t.selectionEnd;let r=t.selectionStart;let i=t.selectionEnd;expandSelectionToLine(t);const s=t.value.slice(t.selectionStart,t.selectionEnd);const[o,l,c]=clearExistingListStyle(e,s);const u=c.split("\n").map(((t,n)=>`${makePrefix(n,e.unorderedList)}${t}`));const d=u.reduce(((t,n,r)=>t+makePrefix(r,e.unorderedList).length),0);const f=u.reduce(((t,n,r)=>t+makePrefix(r,!e.unorderedList).length),0);if(o.processed){if(n){r=Math.max(r-makePrefix(0,e.unorderedList).length,0);i=r}else{r=t.selectionStart;i=t.selectionEnd-d}return{text:c,selectionStart:r,selectionEnd:i}}const{newlinesToAppend:h,newlinesToPrepend:p}=newlinesToSurroundSelectedText(t);const m=h+u.join("\n")+p;if(n){r=Math.max(r+makePrefix(0,e.unorderedList).length+h.length,0);i=r}else if(l.processed){r=Math.max(t.selectionStart+h.length,0);i=t.selectionEnd+h.length+d-f}else{r=Math.max(t.selectionStart+h.length,0);i=t.selectionEnd+h.length+d}return{text:m,selectionStart:r,selectionEnd:i}}function applyStyle(t,e){const n=t.closest("markdown-toolbar");if(!(n instanceof MarkdownToolbarElement))return;const r={prefix:"",suffix:"",blockPrefix:"",blockSuffix:"",multiline:false,replaceNext:"",prefixSpace:false,scanFor:"",surroundWithNewlines:false,orderedList:false,unorderedList:false,trimFirst:false};const i=Object.assign(Object.assign({},r),e);const s=n.field;if(s){s.focus();styleSelectedText(s,i)}}function camelize(t){return t.replace(/(?:[_-])([a-z0-9])/g,((t,e)=>e.toUpperCase()))}function namespaceCamelize(t){return camelize(t.replace(/--/g,"-").replace(/__/g,"_"))}function capitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)}function dasherize(t){return t.replace(/([A-Z])/g,((t,e)=>`-${e.toLowerCase()}`))}function isSomething(t){return t!==null&&t!==void 0}function hasProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function readInheritableStaticArrayValues(t,e){const n=getAncestorsForConstructor(t);return Array.from(n.reduce(((t,n)=>{getOwnStaticArrayValues(n,e).forEach((e=>t.add(e)));return t}),new Set))}function readInheritableStaticObjectPairs(t,e){const n=getAncestorsForConstructor(t);return n.reduce(((t,n)=>{t.push(...getOwnStaticObjectPairs(n,e));return t}),[])}function getAncestorsForConstructor(t){const e=[];while(t){e.push(t);t=Object.getPrototypeOf(t)}return e.reverse()}function getOwnStaticArrayValues(t,e){const n=t[e];return Array.isArray(n)?n:[]}function getOwnStaticObjectPairs(t,e){const n=t[e];return n?Object.keys(n).map((t=>[t,n[t]])):[]}(()=>{function extendWithReflect(t){function extended(){return Reflect.construct(t,arguments,new.target)}extended.prototype=Object.create(t.prototype,{constructor:{value:extended}});Reflect.setPrototypeOf(extended,t);return extended}function testReflectExtension(){const a=function(){this.a.call(this)};const t=extendWithReflect(a);t.prototype.a=function(){};return new t}try{testReflectExtension();return extendWithReflect}catch(t){return t=>class extended extends t{}}})();({controllerAttribute:"data-controller",actionAttribute:"data-action",targetAttribute:"data-target",targetAttributeForScope:t=>`data-${t}-target`,outletAttributeForScope:(t,e)=>`data-${t}-${e}-outlet`,keyMappings:Object.assign(Object.assign({enter:"Enter",tab:"Tab",esc:"Escape",space:" ",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",home:"Home",end:"End",page_up:"PageUp",page_down:"PageDown"},objectFromEntries("abcdefghijklmnopqrstuvwxyz".split("").map((t=>[t,t])))),objectFromEntries("0123456789".split("").map((t=>[t,t]))))});function objectFromEntries(t){return t.reduce(((t,[e,n])=>Object.assign(Object.assign({},t),{[e]:n})),{})}function ClassPropertiesBlessing(t){const e=readInheritableStaticArrayValues(t,"classes");return e.reduce(((t,e)=>Object.assign(t,propertiesForClassDefinition(e))),{})}function propertiesForClassDefinition(t){return{[`${t}Class`]:{get(){const{classes:e}=this;if(e.has(t))return e.get(t);{const n=e.getAttributeName(t);throw new Error(`Missing attribute "${n}"`)}}},[`${t}Classes`]:{get(){return this.classes.getAll(t)}},[`has${capitalize(t)}Class`]:{get(){return this.classes.has(t)}}}}function OutletPropertiesBlessing(t){const e=readInheritableStaticArrayValues(t,"outlets");return e.reduce(((t,e)=>Object.assign(t,propertiesForOutletDefinition(e))),{})}function getOutletController(t,e,n){return t.application.getControllerForElementAndIdentifier(e,n)}function getControllerAndEnsureConnectedScope(t,e,n){let r=getOutletController(t,e,n);if(r)return r;t.application.router.proposeToConnectScopeForElementAndIdentifier(e,n);r=getOutletController(t,e,n);return r||void 0}function propertiesForOutletDefinition(t){const e=namespaceCamelize(t);return{[`${e}Outlet`]:{get(){const e=this.outlets.find(t);const n=this.outlets.getSelectorForOutletName(t);if(e){const n=getControllerAndEnsureConnectedScope(this,e,t);if(n)return n;throw new Error(`The provided outlet element is missing an outlet controller "${t}" instance for host controller "${this.identifier}"`)}throw new Error(`Missing outlet element "${t}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${n}".`)}},[`${e}Outlets`]:{get(){const e=this.outlets.findAll(t);return e.length>0?e.map((e=>{const n=getControllerAndEnsureConnectedScope(this,e,t);if(n)return n;console.warn(`The provided outlet element is missing an outlet controller "${t}" instance for host controller "${this.identifier}"`,e)})).filter((t=>t)):[]}},[`${e}OutletElement`]:{get(){const e=this.outlets.find(t);const n=this.outlets.getSelectorForOutletName(t);if(e)return e;throw new Error(`Missing outlet element "${t}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${n}".`)}},[`${e}OutletElements`]:{get(){return this.outlets.findAll(t)}},[`has${capitalize(e)}Outlet`]:{get(){return this.outlets.has(t)}}}}function TargetPropertiesBlessing(t){const e=readInheritableStaticArrayValues(t,"targets");return e.reduce(((t,e)=>Object.assign(t,propertiesForTargetDefinition(e))),{})}function propertiesForTargetDefinition(t){return{[`${t}Target`]:{get(){const e=this.targets.find(t);if(e)return e;throw new Error(`Missing target element "${t}" for "${this.identifier}" controller`)}},[`${t}Targets`]:{get(){return this.targets.findAll(t)}},[`has${capitalize(t)}Target`]:{get(){return this.targets.has(t)}}}}function ValuePropertiesBlessing(t){const e=readInheritableStaticObjectPairs(t,"values");const n={valueDescriptorMap:{get(){return e.reduce(((t,e)=>{const n=parseValueDefinitionPair(e,this.identifier);const r=this.data.getAttributeNameForKey(n.key);return Object.assign(t,{[r]:n})}),{})}}};return e.reduce(((t,e)=>Object.assign(t,propertiesForValueDefinitionPair(e))),n)}function propertiesForValueDefinitionPair(t,e){const n=parseValueDefinitionPair(t,e);const{key:r,name:i,reader:s,writer:o}=n;return{[i]:{get(){const t=this.data.get(r);return t!==null?s(t):n.defaultValue},set(t){t===void 0?this.data.delete(r):this.data.set(r,o(t))}},[`has${capitalize(i)}`]:{get(){return this.data.has(r)||n.hasCustomDefaultValue}}}}function parseValueDefinitionPair([t,e],n){return valueDescriptorForTokenAndTypeDefinition({controller:n,token:t,typeDefinition:e})}function parseValueTypeConstant(t){switch(t){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function parseValueTypeDefault(t){switch(typeof t){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}return Array.isArray(t)?"array":Object.prototype.toString.call(t)==="[object Object]"?"object":void 0}function parseValueTypeObject(t){const{controller:e,token:n,typeObject:r}=t;const i=isSomething(r.type);const s=isSomething(r.default);const o=i&&s;const l=i&&!s;const c=!i&&s;const u=parseValueTypeConstant(r.type);const d=parseValueTypeDefault(t.typeObject.default);if(l)return u;if(c)return d;if(u!==d){const t=e?`${e}.${n}`:n;throw new Error(`The specified default value for the Stimulus Value "${t}" must match the defined type "${u}". The provided default value of "${r.default}" is of type "${d}".`)}return o?u:void 0}function parseValueTypeDefinition(t){const{controller:e,token:n,typeDefinition:r}=t;const i={controller:e,token:n,typeObject:r};const s=parseValueTypeObject(i);const o=parseValueTypeDefault(r);const l=parseValueTypeConstant(r);const c=s||o||l;if(c)return c;const u=e?`${e}.${r}`:n;throw new Error(`Unknown value type "${u}" for "${n}" value`)}function defaultValueForDefinition(t){const e=parseValueTypeConstant(t);if(e)return l[e];const n=hasProperty(t,"default");const r=hasProperty(t,"type");const i=t;if(n)return i.default;if(r){const{type:t}=i;const e=parseValueTypeConstant(t);if(e)return l[e]}return t}function valueDescriptorForTokenAndTypeDefinition(t){const{token:e,typeDefinition:n}=t;const r=`${dasherize(e)}-value`;const i=parseValueTypeDefinition(t);return{type:i,key:r,name:camelize(r),get defaultValue(){return defaultValueForDefinition(n)},get hasCustomDefaultValue(){return parseValueTypeDefault(n)!==void 0},reader:c[i],writer:u[i]||u.default}}const l={get array(){return[]},boolean:false,number:0,get object(){return{}},string:""};const c={array(t){const e=JSON.parse(t);if(!Array.isArray(e))throw new TypeError(`expected value of type "array" but instead got value "${t}" of type "${parseValueTypeDefault(e)}"`);return e},boolean(t){return!(t=="0"||String(t).toLowerCase()=="false")},number(t){return Number(t.replace(/_/g,""))},object(t){const e=JSON.parse(t);if(e===null||typeof e!="object"||Array.isArray(e))throw new TypeError(`expected value of type "object" but instead got value "${t}" of type "${parseValueTypeDefault(e)}"`);return e},string(t){return t}};const u={default:writeString,array:writeJSON,object:writeJSON};function writeJSON(t){return JSON.stringify(t)}function writeString(t){return`${t}`}class Controller{constructor(t){this.context=t}static get shouldLoad(){return true}static afterLoad(t,e){}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get outlets(){return this.scope.outlets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(t,{target:e=this.element,detail:n={},prefix:r=this.identifier,bubbles:i=true,cancelable:s=true}={}){const o=r?`${r}:${t}`:t;const l=new CustomEvent(o,{detail:n,bubbles:i,cancelable:s});e.dispatchEvent(l);return l}}Controller.blessings=[ClassPropertiesBlessing,TargetPropertiesBlessing,ValuePropertiesBlessing,OutletPropertiesBlessing];Controller.targets=[];Controller.outlets=[];Controller.values={};var d={exports:{}};(function(t){(function(e){t.exports=e()})((function(t){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function md5cycle(t,e){var n=t[0],r=t[1],i=t[2],s=t[3];n+=(r&i|~r&s)+e[0]-680876936|0;n=(n<<7|n>>>25)+r|0;s+=(n&r|~n&i)+e[1]-389564586|0;s=(s<<12|s>>>20)+n|0;i+=(s&n|~s&r)+e[2]+606105819|0;i=(i<<17|i>>>15)+s|0;r+=(i&s|~i&n)+e[3]-1044525330|0;r=(r<<22|r>>>10)+i|0;n+=(r&i|~r&s)+e[4]-176418897|0;n=(n<<7|n>>>25)+r|0;s+=(n&r|~n&i)+e[5]+1200080426|0;s=(s<<12|s>>>20)+n|0;i+=(s&n|~s&r)+e[6]-1473231341|0;i=(i<<17|i>>>15)+s|0;r+=(i&s|~i&n)+e[7]-45705983|0;r=(r<<22|r>>>10)+i|0;n+=(r&i|~r&s)+e[8]+1770035416|0;n=(n<<7|n>>>25)+r|0;s+=(n&r|~n&i)+e[9]-1958414417|0;s=(s<<12|s>>>20)+n|0;i+=(s&n|~s&r)+e[10]-42063|0;i=(i<<17|i>>>15)+s|0;r+=(i&s|~i&n)+e[11]-1990404162|0;r=(r<<22|r>>>10)+i|0;n+=(r&i|~r&s)+e[12]+1804603682|0;n=(n<<7|n>>>25)+r|0;s+=(n&r|~n&i)+e[13]-40341101|0;s=(s<<12|s>>>20)+n|0;i+=(s&n|~s&r)+e[14]-1502002290|0;i=(i<<17|i>>>15)+s|0;r+=(i&s|~i&n)+e[15]+1236535329|0;r=(r<<22|r>>>10)+i|0;n+=(r&s|i&~s)+e[1]-165796510|0;n=(n<<5|n>>>27)+r|0;s+=(n&i|r&~i)+e[6]-1069501632|0;s=(s<<9|s>>>23)+n|0;i+=(s&r|n&~r)+e[11]+643717713|0;i=(i<<14|i>>>18)+s|0;r+=(i&n|s&~n)+e[0]-373897302|0;r=(r<<20|r>>>12)+i|0;n+=(r&s|i&~s)+e[5]-701558691|0;n=(n<<5|n>>>27)+r|0;s+=(n&i|r&~i)+e[10]+38016083|0;s=(s<<9|s>>>23)+n|0;i+=(s&r|n&~r)+e[15]-660478335|0;i=(i<<14|i>>>18)+s|0;r+=(i&n|s&~n)+e[4]-405537848|0;r=(r<<20|r>>>12)+i|0;n+=(r&s|i&~s)+e[9]+568446438|0;n=(n<<5|n>>>27)+r|0;s+=(n&i|r&~i)+e[14]-1019803690|0;s=(s<<9|s>>>23)+n|0;i+=(s&r|n&~r)+e[3]-187363961|0;i=(i<<14|i>>>18)+s|0;r+=(i&n|s&~n)+e[8]+1163531501|0;r=(r<<20|r>>>12)+i|0;n+=(r&s|i&~s)+e[13]-1444681467|0;n=(n<<5|n>>>27)+r|0;s+=(n&i|r&~i)+e[2]-51403784|0;s=(s<<9|s>>>23)+n|0;i+=(s&r|n&~r)+e[7]+1735328473|0;i=(i<<14|i>>>18)+s|0;r+=(i&n|s&~n)+e[12]-1926607734|0;r=(r<<20|r>>>12)+i|0;n+=(r^i^s)+e[5]-378558|0;n=(n<<4|n>>>28)+r|0;s+=(n^r^i)+e[8]-2022574463|0;s=(s<<11|s>>>21)+n|0;i+=(s^n^r)+e[11]+1839030562|0;i=(i<<16|i>>>16)+s|0;r+=(i^s^n)+e[14]-35309556|0;r=(r<<23|r>>>9)+i|0;n+=(r^i^s)+e[1]-1530992060|0;n=(n<<4|n>>>28)+r|0;s+=(n^r^i)+e[4]+1272893353|0;s=(s<<11|s>>>21)+n|0;i+=(s^n^r)+e[7]-155497632|0;i=(i<<16|i>>>16)+s|0;r+=(i^s^n)+e[10]-1094730640|0;r=(r<<23|r>>>9)+i|0;n+=(r^i^s)+e[13]+681279174|0;n=(n<<4|n>>>28)+r|0;s+=(n^r^i)+e[0]-358537222|0;s=(s<<11|s>>>21)+n|0;i+=(s^n^r)+e[3]-722521979|0;i=(i<<16|i>>>16)+s|0;r+=(i^s^n)+e[6]+76029189|0;r=(r<<23|r>>>9)+i|0;n+=(r^i^s)+e[9]-640364487|0;n=(n<<4|n>>>28)+r|0;s+=(n^r^i)+e[12]-421815835|0;s=(s<<11|s>>>21)+n|0;i+=(s^n^r)+e[15]+530742520|0;i=(i<<16|i>>>16)+s|0;r+=(i^s^n)+e[2]-995338651|0;r=(r<<23|r>>>9)+i|0;n+=(i^(r|~s))+e[0]-198630844|0;n=(n<<6|n>>>26)+r|0;s+=(r^(n|~i))+e[7]+1126891415|0;s=(s<<10|s>>>22)+n|0;i+=(n^(s|~r))+e[14]-1416354905|0;i=(i<<15|i>>>17)+s|0;r+=(s^(i|~n))+e[5]-57434055|0;r=(r<<21|r>>>11)+i|0;n+=(i^(r|~s))+e[12]+1700485571|0;n=(n<<6|n>>>26)+r|0;s+=(r^(n|~i))+e[3]-1894986606|0;s=(s<<10|s>>>22)+n|0;i+=(n^(s|~r))+e[10]-1051523|0;i=(i<<15|i>>>17)+s|0;r+=(s^(i|~n))+e[1]-2054922799|0;r=(r<<21|r>>>11)+i|0;n+=(i^(r|~s))+e[8]+1873313359|0;n=(n<<6|n>>>26)+r|0;s+=(r^(n|~i))+e[15]-30611744|0;s=(s<<10|s>>>22)+n|0;i+=(n^(s|~r))+e[6]-1560198380|0;i=(i<<15|i>>>17)+s|0;r+=(s^(i|~n))+e[13]+1309151649|0;r=(r<<21|r>>>11)+i|0;n+=(i^(r|~s))+e[4]-145523070|0;n=(n<<6|n>>>26)+r|0;s+=(r^(n|~i))+e[11]-1120210379|0;s=(s<<10|s>>>22)+n|0;i+=(n^(s|~r))+e[2]+718787259|0;i=(i<<15|i>>>17)+s|0;r+=(s^(i|~n))+e[9]-343485551|0;r=(r<<21|r>>>11)+i|0;t[0]=n+t[0]|0;t[1]=r+t[1]|0;t[2]=i+t[2]|0;t[3]=s+t[3]|0}function md5blk(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function md5blk_array(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return n}function md51(t){var e,n,r,i,s,o,l=t.length,c=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=l;e+=64)md5cycle(c,md5blk(t.substring(e-64,e)));t=t.substring(e-64);n=t.length;r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n;e+=1)r[e>>2]|=t.charCodeAt(e)<<(e%4<<3);r[e>>2]|=128<<(e%4<<3);if(e>55){md5cycle(c,r);for(e=0;e<16;e+=1)r[e]=0}i=l*8;i=i.toString(16).match(/(.*?)(.{0,8})$/);s=parseInt(i[2],16);o=parseInt(i[1],16)||0;r[14]=s;r[15]=o;md5cycle(c,r);return c}function md51_array(t){var e,n,r,i,s,o,l=t.length,c=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=l;e+=64)md5cycle(c,md5blk_array(t.subarray(e-64,e)));t=e-64<l?t.subarray(e-64):new Uint8Array(0);n=t.length;r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n;e+=1)r[e>>2]|=t[e]<<(e%4<<3);r[e>>2]|=128<<(e%4<<3);if(e>55){md5cycle(c,r);for(e=0;e<16;e+=1)r[e]=0}i=l*8;i=i.toString(16).match(/(.*?)(.{0,8})$/);s=parseInt(i[2],16);o=parseInt(i[1],16)||0;r[14]=s;r[15]=o;md5cycle(c,r);return c}function rhex(t){var n,r="";for(n=0;n<4;n+=1)r+=e[t>>n*8+4&15]+e[t>>n*8&15];return r}function hex(t){var e;for(e=0;e<t.length;e+=1)t[e]=rhex(t[e]);return t.join("")}hex(md51("hello"))!=="5d41402abc4b2a76b9719d911017c592";typeof ArrayBuffer==="undefined"||ArrayBuffer.prototype.slice||function(){function clamp(t,e){t=t|0||0;return t<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(e,n){var r,i,s,o,l=this.byteLength,c=clamp(e,l),u=l;n!==t&&(u=clamp(n,l));if(c>u)return new ArrayBuffer(0);r=u-c;i=new ArrayBuffer(r);s=new Uint8Array(i);o=new Uint8Array(this,c,r);s.set(o);return i}}();function toUtf8(t){/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t)));return t}function utf8Str2ArrayBuffer(t,e){var n,r=t.length,i=new ArrayBuffer(r),s=new Uint8Array(i);for(n=0;n<r;n+=1)s[n]=t.charCodeAt(n);return e?s:i}function arrayBuffer2Utf8Str(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function concatenateArrayBuffers(t,e,n){var r=new Uint8Array(t.byteLength+e.byteLength);r.set(new Uint8Array(t));r.set(new Uint8Array(e),t.byteLength);return r}function hexToBinaryString(t){var e,n=[],r=t.length;for(e=0;e<r-1;e+=2)n.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,n)}function SparkMD5(){this.reset()}SparkMD5.prototype.append=function(t){this.appendBinary(toUtf8(t));return this};SparkMD5.prototype.appendBinary=function(t){this._buff+=t;this._length+=t.length;var e,n=this._buff.length;for(e=64;e<=n;e+=64)md5cycle(this._hash,md5blk(this._buff.substring(e-64,e)));this._buff=this._buff.substring(e-64);return this};SparkMD5.prototype.end=function(t){var e,n,r=this._buff,i=r.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i;e+=1)s[e>>2]|=r.charCodeAt(e)<<(e%4<<3);this._finish(s,i);n=hex(this._hash);t&&(n=hexToBinaryString(n));this.reset();return n};SparkMD5.prototype.reset=function(){this._buff="";this._length=0;this._hash=[1732584193,-271733879,-1732584194,271733878];return this};SparkMD5.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}};SparkMD5.prototype.setState=function(t){this._buff=t.buff;this._length=t.length;this._hash=t.hash;return this};SparkMD5.prototype.destroy=function(){delete this._hash;delete this._buff;delete this._length};SparkMD5.prototype._finish=function(t,e){var n,r,i,s=e;t[s>>2]|=128<<(s%4<<3);if(s>55){md5cycle(this._hash,t);for(s=0;s<16;s+=1)t[s]=0}n=this._length*8;n=n.toString(16).match(/(.*?)(.{0,8})$/);r=parseInt(n[2],16);i=parseInt(n[1],16)||0;t[14]=r;t[15]=i;md5cycle(this._hash,t)};SparkMD5.hash=function(t,e){return SparkMD5.hashBinary(toUtf8(t),e)};SparkMD5.hashBinary=function(t,e){var n=md51(t),r=hex(n);return e?hexToBinaryString(r):r};SparkMD5.ArrayBuffer=function(){this.reset()};SparkMD5.ArrayBuffer.prototype.append=function(t){var e,n=concatenateArrayBuffers(this._buff.buffer,t),r=n.length;this._length+=t.byteLength;for(e=64;e<=r;e+=64)md5cycle(this._hash,md5blk_array(n.subarray(e-64,e)));this._buff=e-64<r?new Uint8Array(n.buffer.slice(e-64)):new Uint8Array(0);return this};SparkMD5.ArrayBuffer.prototype.end=function(t){var e,n,r=this._buff,i=r.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i;e+=1)s[e>>2]|=r[e]<<(e%4<<3);this._finish(s,i);n=hex(this._hash);t&&(n=hexToBinaryString(n));this.reset();return n};SparkMD5.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._hash=[1732584193,-271733879,-1732584194,271733878];return this};SparkMD5.ArrayBuffer.prototype.getState=function(){var t=SparkMD5.prototype.getState.call(this);t.buff=arrayBuffer2Utf8Str(t.buff);return t};SparkMD5.ArrayBuffer.prototype.setState=function(t){t.buff=utf8Str2ArrayBuffer(t.buff,true);return SparkMD5.prototype.setState.call(this,t)};SparkMD5.ArrayBuffer.prototype.destroy=SparkMD5.prototype.destroy;SparkMD5.ArrayBuffer.prototype._finish=SparkMD5.prototype._finish;SparkMD5.ArrayBuffer.hash=function(t,e){var n=md51_array(new Uint8Array(t)),r=hex(n);return e?hexToBinaryString(r):r};return SparkMD5}))})(d);var f=d.exports;const h=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice;class FileChecksum{static create(t,e){const n=new FileChecksum(t);n.create(e)}constructor(t){this.file=t;this.chunkSize=2097152;this.chunkCount=Math.ceil(this.file.size/this.chunkSize);this.chunkIndex=0}create(t){this.callback=t;this.md5Buffer=new f.ArrayBuffer;this.fileReader=new FileReader;this.fileReader.addEventListener("load",(t=>this.fileReaderDidLoad(t)));this.fileReader.addEventListener("error",(t=>this.fileReaderDidError(t)));this.readNextChunk()}fileReaderDidLoad(t){this.md5Buffer.append(t.target.result);if(!this.readNextChunk()){const t=this.md5Buffer.end(true);const e=btoa(t);this.callback(null,e)}}fileReaderDidError(t){this.callback(`Error reading ${this.file.name}`)}readNextChunk(){if(this.chunkIndex<this.chunkCount||this.chunkIndex==0&&this.chunkCount==0){const t=this.chunkIndex*this.chunkSize;const e=Math.min(t+this.chunkSize,this.file.size);const n=h.call(this.file,t,e);this.fileReader.readAsArrayBuffer(n);this.chunkIndex++;return true}return false}}function getMetaValue(t){const e=findElement(document.head,`meta[name="${t}"]`);if(e)return e.getAttribute("content")}function findElements(t,e){if(typeof t=="string"){e=t;t=document}const n=t.querySelectorAll(e);return toArray(n)}function findElement(t,e){if(typeof t=="string"){e=t;t=document}return t.querySelector(e)}function dispatchEvent(t,e,n={}){const{disabled:r}=t;const{bubbles:i,cancelable:s,detail:o}=n;const l=document.createEvent("Event");l.initEvent(e,i||true,s||true);l.detail=o||{};try{t.disabled=false;t.dispatchEvent(l)}finally{t.disabled=r}return l}function toArray(t){return Array.isArray(t)?t:Array.from?Array.from(t):[].slice.call(t)}class BlobRecord{constructor(t,e,n,r={}){this.file=t;this.attributes={filename:t.name,content_type:t.type||"application/octet-stream",byte_size:t.size,checksum:e};this.xhr=new XMLHttpRequest;this.xhr.open("POST",n,true);this.xhr.responseType="json";this.xhr.setRequestHeader("Content-Type","application/json");this.xhr.setRequestHeader("Accept","application/json");this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");Object.keys(r).forEach((t=>{this.xhr.setRequestHeader(t,r[t])}));const i=getMetaValue("csrf-token");i!=void 0&&this.xhr.setRequestHeader("X-CSRF-Token",i);this.xhr.addEventListener("load",(t=>this.requestDidLoad(t)));this.xhr.addEventListener("error",(t=>this.requestDidError(t)))}get status(){return this.xhr.status}get response(){const{responseType:t,response:e}=this.xhr;return t=="json"?e:JSON.parse(e)}create(t){this.callback=t;this.xhr.send(JSON.stringify({blob:this.attributes}))}requestDidLoad(t){if(this.status>=200&&this.status<300){const{response:t}=this;const{direct_upload:e}=t;delete t.direct_upload;this.attributes=t;this.directUploadData=e;this.callback(null,this.toJSON())}else this.requestDidError(t)}requestDidError(t){this.callback(`Error creating Blob for "${this.file.name}". Status: ${this.status}`)}toJSON(){const t={};for(const e in this.attributes)t[e]=this.attributes[e];return t}}class BlobUpload{constructor(t){this.blob=t;this.file=t.file;const{url:e,headers:n}=t.directUploadData;this.xhr=new XMLHttpRequest;this.xhr.open("PUT",e,true);this.xhr.responseType="text";for(const t in n)this.xhr.setRequestHeader(t,n[t]);this.xhr.addEventListener("load",(t=>this.requestDidLoad(t)));this.xhr.addEventListener("error",(t=>this.requestDidError(t)))}create(t){this.callback=t;this.xhr.send(this.file.slice())}requestDidLoad(t){const{status:e,response:n}=this.xhr;e>=200&&e<300?this.callback(null,n):this.requestDidError(t)}requestDidError(t){this.callback(`Error storing "${this.file.name}". Status: ${this.xhr.status}`)}}let p=0;class DirectUpload{constructor(t,e,n,r={}){this.id=++p;this.file=t;this.url=e;this.delegate=n;this.customHeaders=r}create(t){FileChecksum.create(this.file,((e,n)=>{if(e){t(e);return}const r=new BlobRecord(this.file,n,this.url,this.customHeaders);notify(this.delegate,"directUploadWillCreateBlobWithXHR",r.xhr);r.create((e=>{if(e)t(e);else{const e=new BlobUpload(r);notify(this.delegate,"directUploadWillStoreFileWithXHR",e.xhr);e.create((e=>{e?t(e):t(null,r.toJSON())}))}}))}))}}function notify(t,e,...n){if(t&&typeof t[e]=="function")return t[e](...n)}class DirectUploadController{constructor(t,e){this.input=t;this.file=e;this.directUpload=new DirectUpload(this.file,this.url,this);this.dispatch("initialize")}start(t){const e=document.createElement("input");e.type="hidden";e.name=this.input.name;this.input.insertAdjacentElement("beforebegin",e);this.dispatch("start");this.directUpload.create(((n,r)=>{if(n){e.parentNode.removeChild(e);this.dispatchError(n)}else e.value=r.signed_id;this.dispatch("end");t(n)}))}uploadRequestDidProgress(t){const e=t.loaded/t.total*100;e&&this.dispatch("progress",{progress:e})}get url(){return this.input.getAttribute("data-direct-upload-url")}dispatch(t,e={}){e.file=this.file;e.id=this.directUpload.id;return dispatchEvent(this.input,`direct-upload:${t}`,{detail:e})}dispatchError(t){const e=this.dispatch("error",{error:t});e.defaultPrevented||alert(t)}directUploadWillCreateBlobWithXHR(t){this.dispatch("before-blob-request",{xhr:t})}directUploadWillStoreFileWithXHR(t){this.dispatch("before-storage-request",{xhr:t});t.upload.addEventListener("progress",(t=>this.uploadRequestDidProgress(t)))}}const m="input[type=file][data-direct-upload-url]:not([disabled])";class DirectUploadsController{constructor(t){this.form=t;this.inputs=findElements(t,m).filter((t=>t.files.length))}start(t){const e=this.createDirectUploadControllers();const startNextController=()=>{const n=e.shift();if(n)n.start((e=>{if(e){t(e);this.dispatch("end")}else startNextController()}));else{t();this.dispatch("end")}};this.dispatch("start");startNextController()}createDirectUploadControllers(){const t=[];this.inputs.forEach((e=>{toArray(e.files).forEach((n=>{const r=new DirectUploadController(e,n);t.push(r)}))}));return t}dispatch(t,e={}){return dispatchEvent(this.form,`direct-uploads:${t}`,{detail:e})}}const g="data-direct-uploads-processing";const b=new WeakMap;let y=false;function start(){if(!y){y=true;document.addEventListener("click",didClick,true);document.addEventListener("submit",didSubmitForm,true);document.addEventListener("ajax:before",didSubmitRemoteElement)}}function didClick(t){const e=t.target.closest("button, input");e&&e.type==="submit"&&e.form&&b.set(e.form,e)}function didSubmitForm(t){handleFormSubmissionEvent(t)}function didSubmitRemoteElement(t){t.target.tagName=="FORM"&&handleFormSubmissionEvent(t)}function handleFormSubmissionEvent(t){const e=t.target;if(e.hasAttribute(g)){t.preventDefault();return}const n=new DirectUploadsController(e);const{inputs:r}=n;if(r.length){t.preventDefault();e.setAttribute(g,"");r.forEach(disable);n.start((t=>{e.removeAttribute(g);t?r.forEach(enable):submitForm(e)}))}}function submitForm(t){let e=b.get(t)||findElement(t,"input[type=submit], button[type=submit]");if(e){const{disabled:t}=e;e.disabled=false;e.focus();e.click();e.disabled=t}else{e=document.createElement("input");e.type="submit";e.style.display="none";t.appendChild(e);e.click();t.removeChild(e)}b.delete(t)}function disable(t){t.disabled=true}function enable(t){t.disabled=false}function autostart(){window.ActiveStorage&&start()}setTimeout(autostart,1);class FetchResponse{constructor(t){this.response=t}get statusCode(){return this.response.status}get redirected(){return this.response.redirected}get ok(){return this.response.ok}get unauthenticated(){return this.statusCode===401}get unprocessableEntity(){return this.statusCode===422}get authenticationURL(){return this.response.headers.get("WWW-Authenticate")}get contentType(){const t=this.response.headers.get("Content-Type")||"";return t.replace(/;.*$/,"")}get headers(){return this.response.headers}get html(){return this.contentType.match(/^(application|text)\/(html|xhtml\+xml)$/)?this.text:Promise.reject(new Error(`Expected an HTML response but got "${this.contentType}" instead`))}get json(){return this.contentType.match(/^application\/.*json$/)?this.responseJson||(this.responseJson=this.response.json()):Promise.reject(new Error(`Expected a JSON response but got "${this.contentType}" instead`))}get text(){return this.responseText||(this.responseText=this.response.text())}get isTurboStream(){return this.contentType.match(/^text\/vnd\.turbo-stream\.html/)}get isScript(){return this.contentType.match(/\b(?:java|ecma)script\b/)}async renderTurboStream(){if(!this.isTurboStream)return Promise.reject(new Error(`Expected a Turbo Stream response but got "${this.contentType}" instead`));window.Turbo?await window.Turbo.renderStreamMessage(await this.text):console.warn("You must set `window.Turbo = Turbo` to automatically process Turbo Stream events with request.js")}async activeScript(){if(!this.isScript)return Promise.reject(new Error(`Expected a Script response but got "${this.contentType}" instead`));{const t=document.createElement("script");const e=document.querySelector("meta[name=csp-nonce]");const n=e&&e.content;n&&t.setAttribute("nonce",n);t.innerHTML=await this.text;document.body.appendChild(t)}}}class RequestInterceptor{static register(t){this.interceptor=t}static get(){return this.interceptor}static reset(){this.interceptor=void 0}}function getCookie(t){const e=document.cookie?document.cookie.split("; "):[];const n=`${encodeURIComponent(t)}=`;const r=e.find((t=>t.startsWith(n)));if(r){const t=r.split("=").slice(1).join("=");if(t)return decodeURIComponent(t)}}function compact(t){const e={};for(const n in t){const r=t[n];r!==void 0&&(e[n]=r)}return e}function metaContent(t){const e=document.head.querySelector(`meta[name="${t}"]`);return e&&e.content}function stringEntriesFromFormData(t){return[...t].reduce(((t,[e,n])=>t.concat(typeof n==="string"?[[e,n]]:[])),[])}function mergeEntries(t,e){for(const[n,r]of e)if(!(r instanceof window.File))if(t.has(n)&&!n.includes("[]")){t.delete(n);t.set(n,r)}else t.append(n,r)}class FetchRequest{constructor(t,e,n={}){this.method=t;this.options=n;this.originalUrl=e.toString()}async perform(){try{const t=RequestInterceptor.get();t&&await t(this)}catch(t){console.error(t)}const t=this.responseKind==="turbo-stream"&&window.Turbo?window.Turbo.fetch:window.fetch;const e=new FetchResponse(await t(this.url,this.fetchOptions));if(e.unauthenticated&&e.authenticationURL)return Promise.reject(window.location.href=e.authenticationURL);e.isScript&&await e.activeScript();const n=e.ok||e.unprocessableEntity;n&&e.isTurboStream&&await e.renderTurboStream();return e}addHeader(t,e){const n=this.additionalHeaders;n[t]=e;this.options.headers=n}sameHostname(){if(!this.originalUrl.startsWith("http:"))return true;try{return new URL(this.originalUrl).hostname===window.location.hostname}catch(t){return true}}get fetchOptions(){return{method:this.method.toUpperCase(),headers:this.headers,body:this.formattedBody,signal:this.signal,credentials:this.credentials,redirect:this.redirect}}get headers(){const t={"X-Requested-With":"XMLHttpRequest","Content-Type":this.contentType,Accept:this.accept};this.sameHostname()&&(t["X-CSRF-Token"]=this.csrfToken);return compact(Object.assign(t,this.additionalHeaders))}get csrfToken(){return getCookie(metaContent("csrf-param"))||metaContent("csrf-token")}get contentType(){return this.options.contentType?this.options.contentType:this.body==null||this.body instanceof window.FormData?void 0:this.body instanceof window.File?this.body.type:"application/json"}get accept(){switch(this.responseKind){case"html":return"text/html, application/xhtml+xml";case"turbo-stream":return"text/vnd.turbo-stream.html, text/html, application/xhtml+xml";case"json":return"application/json, application/vnd.api+json";case"script":return"text/javascript, application/javascript";default:return"*/*"}}get body(){return this.options.body}get query(){const t=(this.originalUrl.split("?")[1]||"").split("#")[0];const e=new URLSearchParams(t);let n=this.options.query;n=n instanceof window.FormData?stringEntriesFromFormData(n):n instanceof window.URLSearchParams?n.entries():Object.entries(n||{});mergeEntries(e,n);const r=e.toString();return r.length>0?`?${r}`:""}get url(){return this.originalUrl.split("?")[0].split("#")[0]+this.query}get responseKind(){return this.options.responseKind||"html"}get signal(){return this.options.signal}get redirect(){return this.options.redirect||"follow"}get credentials(){return this.options.credentials||"same-origin"}get additionalHeaders(){return this.options.headers||{}}get formattedBody(){const t=Object.prototype.toString.call(this.body)==="[object String]";const e=this.headers["Content-Type"]==="application/json";return e&&!t?JSON.stringify(this.body):this.body}}async function post(t,e){const n=new FetchRequest("post",t,e);return n.perform()}function insertText(t,e){var n,r,i;const s=t.value.slice(0,(n=t.selectionStart)!==null&&n!==void 0?n:void 0);const o=t.value.slice((r=t.selectionEnd)!==null&&r!==void 0?r:void 0);let l=true;t.contentEditable="true";try{l=document.execCommand("insertText",false,e)}catch(t){l=false}t.contentEditable="false";l&&!t.value.slice(0,(i=t.selectionStart)!==null&&i!==void 0?i:void 0).endsWith(e)&&(l=false);if(!l){try{document.execCommand("ms-beginUndoUnit")}catch(t){}t.value=s+e+o;try{document.execCommand("ms-endUndoUnit")}catch(t){}t.dispatchEvent(new CustomEvent("change",{bubbles:true,cancelable:true}))}}const w=new WeakMap;function setSkipFormattingFlag(t){const{currentTarget:e}=t;const n=t.code==="KeyV"&&(t.ctrlKey||t.metaKey)&&t.shiftKey;(n||n&&t.altKey)&&w.set(e,true)}function unsetSkipFormattedFlag(t){const{currentTarget:e}=t;w.delete(e)}function shouldSkipFormatting(t){var e;const n=(e=w.get(t))!==null&&e!==void 0&&e;return n}function installAround(t,e,n){t.addEventListener("keydown",setSkipFormattingFlag);for(const r of e)r(t,n);t.addEventListener("paste",unsetSkipFormattedFlag)}function uninstall$5(t){t.removeEventListener("keydown",setSkipFormattingFlag);t.removeEventListener("paste",unsetSkipFormattedFlag)}function install$4(t){t.addEventListener("paste",onPaste$4)}function uninstall$4(t){t.removeEventListener("paste",onPaste$4)}function onPaste$4(t){const e=t.clipboardData;const{currentTarget:n}=t;if(shouldSkipFormatting(n))return;if(!e||!hasHTML(e))return;const r=t.currentTarget;if(!(r instanceof HTMLTextAreaElement))return;if(isWithinUserMention(r))return;let i=e.getData("text/plain");const s=e.getData("text/html");const o=s.replace(/\u00A0/g," ").replace(/\uC2A0/g," ");if(!s)return;i=i.trim();if(!i)return;const l=new DOMParser;const c=l.parseFromString(o,"text/html");const u=c.createTreeWalker(c.body,NodeFilter.SHOW_ALL,(t=>t.parentNode&&isLink(t.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT));const d=convertToMarkdown(i,u);if(d!==i){t.stopPropagation();t.preventDefault();insertText(r,d)}}function convertToMarkdown(t,e){let n=e.firstChild();let r=t;let i=0;let s=0;const o=1e4;while(n&&s<o){s++;const t=isLink(n)?(n.textContent||"").replace(/[\t\n\r ]+/g," "):(n===null||n===void 0?void 0:n.wholeText)||"";if(isEmptyString(t)){n=e.nextNode();continue}if(!isLink(n)){i+=t.replace(/[\t\n\r ]+/g," ").trimStart().length;n=e.nextNode();continue}const o=r.indexOf(t,i);if(o>=0){const e=linkify$2(n,t);r=r.slice(0,o)+e+r.slice(o+t.length);i=o+e.length}n=e.nextNode()}return s===o?t:r}function isWithinUserMention(t){const e=t.selectionStart||0;if(e===0)return false;const n=t.value.substring(e-1,e);return n==="@"}function isEmptyString(t){return!t||(t===null||t===void 0?void 0:t.trim().length)===0}function isLink(t){var e;return((e=t.tagName)===null||e===void 0?void 0:e.toLowerCase())==="a"&&t.hasAttribute("href")}function hasHTML(t){return t.types.includes("text/html")}function linkify$2(t,e){const n=t.href||"";let r="";r=isUserMention(t)||isTeamMention(t)?e:isSpecialLink(t)||areEqualLinks(n,e)?n:`[${e}](${n})`;return r}function isSpecialLink(t){return t.className.indexOf("commit-link")>=0||!!t.getAttribute("data-hovercard-type")&&t.getAttribute("data-hovercard-type")!=="user"}function areEqualLinks(t,e){t=t.slice(-1)==="/"?t.slice(0,-1):t;e=e.slice(-1)==="/"?e.slice(0,-1):e;return t.toLowerCase()===e.toLowerCase()}function isUserMention(t){var e;return((e=t.textContent)===null||e===void 0?void 0:e.slice(0,1))==="@"&&t.getAttribute("data-hovercard-type")==="user"}function isTeamMention(t){var e;return((e=t.textContent)===null||e===void 0?void 0:e.slice(0,1))==="@"&&t.getAttribute("data-hovercard-type")==="team"}function install$3(t){t.addEventListener("dragover",onDragover$1);t.addEventListener("drop",onDrop$1);t.addEventListener("paste",onPaste$3)}function uninstall$3(t){t.removeEventListener("dragover",onDragover$1);t.removeEventListener("drop",onDrop$1);t.removeEventListener("paste",onPaste$3)}function onDrop$1(t){const e=t.dataTransfer;if(!e)return;if(hasFile$1(e))return;if(!hasLink(e))return;const n=extractLinks(e);if(!n.some(isImageLink))return;t.stopPropagation();t.preventDefault();const r=t.currentTarget;r instanceof HTMLTextAreaElement&&insertText(r,n.map(linkify$1).join(""))}function onDragover$1(t){const e=t.dataTransfer;e&&(e.dropEffect="link")}function onPaste$3(t){const{currentTarget:e}=t;if(shouldSkipFormatting(e))return;const n=t.clipboardData;if(!n||!hasLink(n))return;const r=extractLinks(n);if(!r.some(isImageLink))return;t.stopPropagation();t.preventDefault();const i=t.currentTarget;i instanceof HTMLTextAreaElement&&insertText(i,r.map(linkify$1).join(""))}function linkify$1(t){return isImageLink(t)?`\n![](${t})\n`:t}function hasFile$1(t){return Array.from(t.types).indexOf("Files")>=0}function hasLink(t){return Array.from(t.types).indexOf("text/uri-list")>=0}function extractLinks(t){return(t.getData("text/uri-list")||"").split("\r\n")}const k=/\.(gif|png|jpe?g)$/i;function isImageLink(t){return k.test(t)}const E=new WeakMap;function install$2(t,e){var n;E.set(t,((n=e===null||e===void 0?void 0:e.defaultPlainTextPaste)===null||n===void 0?void 0:n.urlLinks)===true);t.addEventListener("paste",onPaste$2)}function uninstall$2(t){t.removeEventListener("paste",onPaste$2)}function onPaste$2(t){var e;const{currentTarget:n}=t;const r=n;const i=(e=E.get(r))!==null&&e!==void 0&&e;const s=shouldSkipFormatting(r);if(!i&&s||i&&!s)return;const o=t.clipboardData;if(!o||!hasPlainText(o))return;const l=t.currentTarget;if(!(l instanceof HTMLTextAreaElement))return;const c=o.getData("text/plain");if(!c)return;if(!isURL(c))return;if(isWithinLink(l))return;const u=l.value.substring(l.selectionStart,l.selectionEnd);if(u.length&&!isURL(u.trim())){t.stopPropagation();t.preventDefault();insertText(l,linkify(u,c.trim()))}}function hasPlainText(t){return Array.from(t.types).includes("text/plain")}function isWithinLink(t){const e=t.selectionStart||0;if(e>1){const n=t.value.substring(e-2,e);return n==="]("}return false}function linkify(t,e){return`[${t}](${e})`}function isURL(t){try{const e=new URL(t);return removeTrailingSlash(e.href).trim()===removeTrailingSlash(t).trim()}catch(t){return false}}function removeTrailingSlash(t){return t.endsWith("/")?t.slice(0,t.length-1):t}function install$1(t){t.addEventListener("dragover",onDragover);t.addEventListener("drop",onDrop);t.addEventListener("paste",onPaste$1)}function uninstall$1(t){t.removeEventListener("dragover",onDragover);t.removeEventListener("drop",onDrop);t.removeEventListener("paste",onPaste$1)}function onDrop(t){const e=t.dataTransfer;if(!e)return;if(hasFile(e))return;const n=generateText(e);if(!n)return;t.stopPropagation();t.preventDefault();const r=t.currentTarget;r instanceof HTMLTextAreaElement&&insertText(r,n)}function onDragover(t){const e=t.dataTransfer;e&&(e.dropEffect="copy")}function onPaste$1(t){const{currentTarget:e}=t;if(shouldSkipFormatting(e))return;if(!t.clipboardData)return;const n=generateText(t.clipboardData);if(!n)return;t.stopPropagation();t.preventDefault();const r=t.currentTarget;r instanceof HTMLTextAreaElement&&insertText(r,n)}function hasFile(t){return Array.from(t.types).indexOf("Files")>=0}function columnText(t){const e=" ";const n=(t.textContent||"").trim().replace(/\|/g,"\\|").replace(/\n/g," ");return n||e}function tableHeaders(t){return Array.from(t.querySelectorAll("td, th")).map(columnText)}function tableMarkdown(t){const e=Array.from(t.querySelectorAll("tr"));const n=e.shift();if(!n)return"";const r=tableHeaders(n);const i=r.map((()=>"--"));const s=`${r.join(" | ")}\n${i.join(" | ")}\n`;const o=e.map((t=>Array.from(t.querySelectorAll("td")).map(columnText).join(" | "))).join("\n");return`\n${s}${o}\n\n`}function generateText(t){if(Array.from(t.types).indexOf("text/html")===-1)return;const e=t.getData("text/html");if(!/<table/i.test(e))return;const n=e.substring(0,e.indexOf("<table"));const r=e.lastIndexOf("</table>");if(!n||!r)return;const i=e.substring(r+8);const s=new DOMParser;const o=s.parseFromString(e,"text/html");let l=o.querySelector("table");l=!l||l.closest("[data-paste-markdown-skip]")?null:l;if(!l)return;const c=tableMarkdown(l);return c?[n,c,i].join("").replace(/<meta.*?>/,""):void 0}function install(t){t.addEventListener("paste",onPaste)}function uninstall(t){t.removeEventListener("paste",onPaste)}function onPaste(t){const{currentTarget:e}=t;if(shouldSkipFormatting(e))return;const n=t.clipboardData;if(!n||!hasMarkdown(n))return;const r=t.currentTarget;if(!(r instanceof HTMLTextAreaElement))return;const i=n.getData("text/x-gfm");if(i){t.stopPropagation();t.preventDefault();insertText(r,i)}}function hasMarkdown(t){return Array.from(t.types).indexOf("text/x-gfm")>=0}function subscribe(t,e){installAround(t,[install$1,install$3,install$2,install,install$4],e);return{unsubscribe:()=>{uninstall$5(t);uninstall$1(t);uninstall$4(t);uninstall$3(t);uninstall$2(t);uninstall(t)}}}class marksmith_controller extends Controller{static values={attachUrl:String,previewUrl:String,extraPreviewParams:{type:Object,default:{}},fieldId:String,galleryEnabled:{type:Boolean,default:false},galleryOpenPath:String,fileUploadsEnabled:{type:Boolean,default:true}};static targets=["fieldContainer","fieldElement","previewPane","writeTabButton","previewTabButton","toolbar"];activeTabClass="active";get#t(){return!this.fileUploadsEnabledValue}connect(){subscribe(this.fieldContainerTarget,{defaultPlainTextPaste:{urlLinks:true}})}switchToWrite(t){t.preventDefault();this.writeTabButtonTarget.classList.add(this.activeTabClass);this.previewTabButtonTarget.classList.remove(this.activeTabClass);this.fieldContainerTarget.classList.remove("ms:hidden");this.previewPaneTarget.classList.add("ms:hidden");this.toolbarTarget.classList.remove("ms:opacity-0","ms:pointer-events-none")}switchToPreview(t){t.preventDefault();this.element.focus();this.element.blur();document.activeElement.blur();post(this.previewUrlValue,{body:{body:this.fieldElementTarget.value,element_id:this.previewPaneTarget.id,extra_params:this.extraPreviewParamsValue},responseKind:"turbo-stream"});this.previewPaneTarget.style.minHeight=`${this.fieldElementTarget.offsetHeight}px`;this.writeTabButtonTarget.classList.remove(this.activeTabClass);this.previewTabButtonTarget.classList.add(this.activeTabClass);this.fieldContainerTarget.classList.add("ms:hidden");this.previewPaneTarget.classList.remove("ms:hidden");this.toolbarTarget.classList.add("ms:opacity-0","ms:pointer-events-none")}dropUpload(t){if(!this.#t){t.preventDefault();this.#e(t.dataTransfer.files)}}pasteUpload(t){if(!this.#t&&t.clipboardData.files.length){t.preventDefault();this.#e(t.clipboardData.files)}}buttonUpload(t){t.preventDefault();const e=document.createElement("input");e.type="file";e.multiple=true;e.accept="image/*,.pdf,.doc,.docx,.txt";e.addEventListener("change",(t=>{this.#e(t.target.files)}));e.click()}insertAttachments(t,e){const n=t.map((t=>{const{blob:e,path:n,url:r}=t;const i=this.#n(e.filename,n,e.content_type);this.#r(i)}));this.editor?.chain().focus().setAttachment(n).run()}#e(t){Array.from(t).forEach((t=>this.#i(t)))}#i(t){const e=new DirectUpload(t,this.attachUrlValue);e.create(((t,e)=>{if(t)console.log("Error",t);else{const t=this.#n(e.filename,this.#s(e),e.content_type);this.#r(t)}}))}#r(t){const e=this.fieldElementTarget.selectionStart;const n=this.fieldElementTarget.selectionEnd;this.fieldElementTarget.setRangeText(t,e,n)}#s(t){return`/rails/active_storage/blobs/redirect/${t.signed_id}/${encodeURIComponent(t.filename)}`}#n(t,e,n){const r=this.#o(n)?"!":"";return`${r}[${t}](${e})\n`}#o(t){return["image/jpeg","image/gif","image/png"].includes(t)}}class list_continuation_controller extends Controller{connect(){this.isInsertLineBreak=false;this.isProcessing=false;this.SPACE_PATTERN=/^(\s*)?/;this.LIST_PATTERN=/^(\s*)([*-]|(\d+)\.)\s(\[[\sx]\]\s)?/}handleBeforeInput(t){this.isProcessing||(this.isInsertLineBreak=t.inputType==="insertLineBreak")}handleInput(t){if(!this.isProcessing&&(this.isInsertLineBreak||t.inputType==="insertLineBreak")){this.handleListContinuation(t.target);this.isInsertLineBreak=false}}handleListContinuation(t){if(this.isProcessing)return;const e=this.analyzeCurrentLine(t.value,[t.selectionStart,t.selectionEnd]);if(e!==void 0){this.isProcessing=true;try{this.applyTextChange(t,e)}finally{setTimeout((()=>{this.isProcessing=false}),0)}}}analyzeCurrentLine(t,[e]){if(!e||!t)return;const n=t.substring(0,e).split("\n");const r=n[n.length-2];const i=r?.match(this.LIST_PATTERN);if(!i)return;const[s,o,l,c,u]=i;const d=r.replace(s,"").trim();if(d.length===0){const n=e-`\n${s}`.length;return{text:t.substring(0,n)+t.substring(e),selection:[n,n],operation:"delete"}}const f=c?`${parseInt(c,10)+1}.`:l;const h=`${o}${f} ${u?"[ ] ":""}`;return{text:t.substring(0,e)+h+t.substring(e),selection:[e+h.length,e+h.length],operation:"insert"}}applyTextChange(t,{text:e,selection:n}){t.value=e;const[r,i]=n;t.selectionStart=r;t.selectionEnd=i}}export{list_continuation_controller as ListContinuationController,marksmith_controller as MarksmithController};

